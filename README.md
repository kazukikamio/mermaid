```mermaid
flowchart TD
  %% =========================
  %% サンプル：購買申請〜発注〜検収〜支払フロー（例外/並行/SLAあり）
  %% =========================

  A([開始]) --> B[申請者：購買申請を作成]
  B --> C{必須項目/添付は揃っている？}
  C -- No --> C1[申請者：不足を補完] --> B
  C -- Yes --> D[システム：申請ID採番・監査ログ記録]

  D --> E{金額/カテゴリでルート判定}
  E -->|少額・標準品| F[自動チェック：予算残/取引先与信/重複申請]
  E -->|高額 or 非標準| G[調達担当：見積依頼（RFQ）作成]

  %% --- 自動チェック分岐
  F --> H{自動チェックOK？}
  H -- No --> H1[差戻し：理由通知（予算不足/与信NG/重複）] --> B
  H -- Yes --> I[一次承認者：承認依頼受領]

  %% --- RFQ分岐（複数社見積・並行）
  G --> G1[システム：候補ベンダへRFQ送付]
  G1 --> G2{{並行：ベンダ見積回収}}:::parallel
  G2 --> V1[ベンダA：見積提出]
  G2 --> V2[ベンダB：見積提出]
  G2 --> V3[ベンダC：見積提出]
  V1 --> G3[調達担当：見積比較表作成]
  V2 --> G3
  V3 --> G3
  G3 --> J{相見積条件を満たす？}
  J -- No --> J1[例外：単一ソース理由書作成] --> K
  J -- Yes --> K[調達担当：推奨ベンダ選定]

  K --> I

  %% --- 承認フロー（段階・差戻し・SLA）
  I --> L{一次承認：OK？}
  L -- No --> L1[差戻し：修正依頼コメント] --> B
  L -- Yes --> M{金額閾値超？（二次承認必要）}
  M -- No --> N[システム：発注準備（POドラフト）]
  M -- Yes --> O[二次承認者：承認依頼受領]

  %% SLA（一定時間応答なし）例
  O --> P{SLA内に応答？}
  P -- No --> P1[自動リマインド → エスカレーション] --> Q[上位承認者：代理承認]
  P -- Yes --> R{二次承認：OK？}
  Q --> R
  R -- No --> R1[却下：理由通知・クローズ] --> Z([終了])
  R -- Yes --> N

  %% --- 発注・契約・例外
  N --> S{契約審査が必要？（非標準条項/高額）}
  S -- Yes --> S1[法務：契約審査] --> S2{契約OK？}
  S2 -- No --> S3[差戻し：条項修正依頼] --> K
  S2 -- Yes --> T[発注担当：PO発行]
  S -- No --> T[発注担当：PO発行]

  T --> U[システム：ベンダへPO送付・監査ログ記録]
  U --> W{{並行：納品/検収と請求書処理}}:::parallel

  %% --- 納品・検収側
  W --> W1[現場：納品受領]
  W1 --> W2{検収OK？}
  W2 -- No --> W3[不具合：返品/再納品手配] --> W1
  W2 -- Yes --> W4[検収確定（GR）]

  %% --- 請求書側（3点照合）
  W --> X1[経理：請求書受領（電子/紙）]
  X1 --> X2[システム：3点照合（PO・GR・請求）]
  X2 --> X3{照合OK？}
  X3 -- No --> X4[差戻し：金額/数量/単価の不一致調整] --> X2
  X3 -- Yes --> X5[支払予定登録]

  %% --- 合流して支払
  W4 --> Y{GR完了 & 支払予定OK？}
  X5 --> Y
  Y -- No --> Y1[保留：不足条件の解消待ち] --> Y
  Y -- Yes --> Y2[支払実行（振込）]
  Y2 --> Y3[完了通知（申請者/調達/経理/ベンダ）]
  Y3 --> Z([終了])

  %% ====== Styles ======
  classDef parallel fill:#f7f7f7,stroke:#999,stroke-dasharray: 5 3,color:#222;
